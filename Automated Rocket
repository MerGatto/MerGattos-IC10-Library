#Automated Rocket by Acilec
alias rocket d0
alias silo d3
alias display d4
alias launchButton d5
alias fuelLeft r15
alias returnFuel r14
alias mode r13
alias state r12
alias quantity r11
alias quantityMax r10

#Display modes
#0 - Idle, 1 - Launching, 2 - Traveling, 3 - Arrived, 4 - Idle at destination, 5 - Returning to launch, 6 - Returned, 7 - Lost in space, 8.xx - Mining, 9.xx - Unloading
#.xx Silo Content (%)

Init:
s rocket Activate 0
s silo Open 0
l quantityMax silo Maximum

WaitLaunch:
l mode rocket Mode
s display Setting mode
l state launchButton Setting
beq state 1 Countdown
yield
j WaitLaunch

Countdown:

sleep 1
s display Setting 10
yield
s display Setting 9
yield
s display Setting 8
yield
s display Setting 7
yield
s display Setting 6
yield
s display Setting 5
yield
s display Setting 4
yield
s display Setting 3
yield
s display Setting 2
yield
s display Setting 1
yield
s display Setting 0
yield

Launching:
s rocket Activate 1
yield
yield
yield
l mode rocket Mode
s display Setting mode
beq mode 4 CheckAvlResources
j Launching

StartMining:
s miningModule1 Activate 1
s miningModule2 Activate 1
l quantity silo Quantity
div quantity quantity quantityMax #calc Silo content (quantity / quantityMax => quantity)
add mode 8 quantity        #Combine mode 8 with Silo content ex: 8,63 => (Mining, Silo content 63%)
s display Setting mode
bge quantity quantityMax Returnhome
l fuelLeft rocket Fuel
l returnFuel rocket ReturnFuelCost
mul returnFuel returnFuel 1.2   #Save some fuel
bge returnFuel fuelLeft Returnhome
l state launchButton Setting
beq state 1 Returnhome

CheckAvlResources:
yield
s rocket Activate 0
l state rocket CollectableGoods
beq state 1 StartMining
yield

StartTravel:
s rocket Activate 2
s display Setting 2

Travel:
yield
l state launchButton Setting
beq state 1 Returnhome
l fuelLeft rocket Fuel
l returnFuel rocket ReturnFuelCost
mul returnFuel returnFuel 1.2   #Save some fuel
bge returnFuel fuelLeft Returnhome
l mode rocket Mode
s display Setting mode
beq mode 3 CheckAvlResources
beq mode 4 CheckAvlResources
j Travel

Returnhome:
s rocket Activate 5
yield

Returning:
l mode rocket Mode
s display Setting mode
beq mode 0 Unload
yield
j Returning

Unload:
l quantity silo Quantity
beq quantity 0 Init      #if quantity = 0 => Unload completed
div quantity quantity quantityMax   #calc Silo content (quantity / quantityMax => quantity)
add mode 9 quantity        #Combine mode 9 with Silo content ex: 9,63 => (Mining, Silo content 63%)
s display Setting mode
s silo Open 1
yield
j Unload